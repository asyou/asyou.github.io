<!DOCTYPE html>
<html>
<head>
<title>PHP对用户敏感信息进行AES加密与解密方法 - 王维的博客</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="../favicon.ico" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
<link href="../highlight/styles/a11y-dark.min.css" rel="stylesheet">
<script src="../highlight/highlight.min.js"></script>
<script >hljs.initHighlightingOnLoad();</script>
<style type="text/css">
    body {
        margin-top: 70px;
    }
    h1 {
        font-size: 18px;
    }
    h3 {
        font-size: 16px;
    }
    p {
        font-size: 14px;
    }
</style>
</head>
<body>
    <nav class="navbar navbar-expand-md bg-dark navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="../index.html">王维的博客</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="../index.html">主页</a></li>
                    <li class="nav-item active"><a class="nav-link" href="../html/php.html">PHP</a></li>
                    <li class="nav-item"><a class="nav-link" href="../html/vue.html">Vue</a></li>
                    <li class="nav-item"><a class="nav-link" href="../html/unicloud.html">uniCloud</a></li>
                    <li class="nav-item"><a class="nav-link" href="../html/notes.html">随手笔记</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="content mt-3">
            <h1>PHP对用户敏感信息进行AES加密与解密方法</h1>
            <span class="date"><small>2022-03-22</small></span>
            <div class="mt-4">
                <p>本篇文章代码来自网上搜集，代码经实际测试没有问题，很适合用来对一些关键信息进行加密与解密。</p>
                <p>网站用户的手机号、身份证号、银行卡等敏感信息建议加密后再存入数据库，否则一旦被暴库后果不堪设想～</p>
                <p>本例代码并不复杂，把加密、解密方法封装成一个PHP类放到vendor或其他目录，写好命名空间，方便多处调用。</p>
                <h3>一、封装代码</h3>
<pre><code class="php">// /vendor/Crypt.php
&lt?php
namespace vendor;

class Crypt
{
    protected static $method = 'AES-256-CBC';

    /**
     * 字符串加密
     * @param string $data
     * @param string $key
     * @return string
     */
    public static function encrypt($data, $key)
    {
        $ivLen = openssl_cipher_iv_length(static::$method);
        $iv = openssl_random_pseudo_bytes($ivLen);
        $text = openssl_encrypt($data, static::$method, $key, OPENSSL_RAW_DATA, $iv);
        return self::safetyBase64Encode($iv.$text);
    }

    /**
     * 字符串解密
     * @param string $text
     * @param string $key
     * @return string
     */
    public static function decrypt($text, $key)
    {
        $cipherText = self::safetyBase64Decode($text);
        $ivLen = openssl_cipher_iv_length(static::$method);
        $iv = substr($cipherText, 0, $ivLen);
        if (strlen($iv) != $ivLen) {
            $iv = substr(str_pad($iv, $ivLen, '0'), 0, $ivLen);
        }
        $cipherText = substr($cipherText, $ivLen);
        $data = openssl_decrypt($cipherText, static::$method, $key, OPENSSL_RAW_DATA, $iv);
        return $data;
    }

    /**
     * base64加密
     * @param string $text
     * @return string
     */
    public static function safetyBase64Encode($text)
    {
        $text = base64_encode($text);
        $text = str_replace(['+', '/'], ['-', '_'], $text);
        return $text;
    }

    /**
     * base64解密
     * @param string $text
     * @return string
     */
    public static function safetyBase64Decode($text)
    {
        $text = str_replace(['-', '_'], ['+', '/'], $text);
        $text = base64_decode($text);
        return $text;
    }
}</code></pre>
                <h3>二、使用示例</h3>
<pre><code class="php">use vendor\Crypt;
$str = Crypt::encrypt('王维的博客','123');
echo $str;  // 输出类似：w263OmkkaiJAHkCBmJByAgRir2KwY9x5S3DnR4-V3Wk=
echo Crypt::decrypt($str, '123'); // 输出：王维的博客
</code></pre>
                <h3>三、说明</h3>
                <p>1、由于$iv参数是动态生成的，所以每次加密后的字符串都不一样；</p>
                <p>2、类中方法皆为静态方法，注意调用方式；</p>
                <p>3、参数$key相当于加密钥匙，一定要保存好，实际项目中每个用户应当有不同的$key；</p>
                <p>4、确保加密/解密用的是同一个$key，否则解密结果为空。</p>
            </div>
        </div>
    </div>
    <footer class="footer mt-3 bg-dark">
        <div class="container pt-3 pb-3 text-light text-center">Copyright &copy;王维 2022 254555778@qq.com</div>
    </footer>
</body>
</html>